# 힙
힙(heap)의 경우 별도로 명시하지 않는 한 CLR에서 관리 힙(managed heap)을 가리킨다. 관리 힙이란 CLR의 가비지 수집기(GC : Garbage Collector)가 할당/해제를 관리하기 때문에 붙여진 이름이다. C#에서 new로 할당되는 모든 참조형 객체는 힙에 할당된다. 
<br>
<br>

C# 프로그램은 코드가 실행되면서 new로 필요한 개체를 힙에 할당한다. 물론 메모리는 무한대로 쓸 수 있는 자원이 아니다. 따라서 일정 수준에 메모리 할당이 발생하면 GC가 동작한다. CG는 힙에 있는 객체 중에서 현재 사용되지 않는 객체는 제거해 버림으로써 여유 공간을 확보한다. 아쉽게도 GC의 동작은 프로그램의 다른 동작을 중지시킨다는 것을 염두에 둬야 한다. 즉, 힙을 많이 사용할수록 GC는 더 자주 동작하고 그만큼 프로그램은 빈번하게 실행이 중지되어 심각한 성능 문제를 겪을 수 있다.

<br>
<br>

## 2. 가비지 수집기
CLR의 힙은 세대(generation)로 나뉘어 관리된다. 처음 new로 할당된 객체는 0세대(generation 0)에 속한다. 이는 GC 타입을 이용해 코드로도 알아낼 수 있다.
<br>
<br>

처음 할당되는 객체는 모두 0세대에 속한다. 0세대 객체의 총 용량이 일정 크기를 넘어가면 GC는 가비지 수집을 한다. 사용되지 않는 0세대 객체가 있으면 없애고, 그 시점에도 사용되고 있는 객체는 1세대(generation 1)로 승격한다. 프로그램이 실행되면서 이런 가비지 수집 작업은 반복되고 1세대로 승격된 객체의 총 용량도 일정 크기를 넘어가게 된다. 그럼 GC는 0세대와 1세대에 모두 가비지 수집을 한다. 2세대까지 작업을 반복한다. CLR의 세대는 2세대가 끝이다. 이후 2세대의 메모리 공간은 시스템이 허용하는 한 계속 커지게 된다.
